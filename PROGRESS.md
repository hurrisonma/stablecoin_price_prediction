# 项目进展记录

## 里程碑

| 阶段 | 目标 | 状态 | 完成日期 |
|------|------|------|----------|
| Phase 1 | 项目结构搭建 | ✅ 已完成 | 2025-12-07 |
| Phase 2 | 数据处理模块 | ✅ 已完成 | 2025-12-07 |
| Phase 3 | 特征设计V2 | ✅ 已完成 | 2025-12-07 |
| Phase 4 | 标签生成修复 | ✅ 已完成 | 2025-12-07 |
| Phase 5 | 模型训练 | 🔄 进行中 | - |

---

## ⚠️ 重要问题记录

### 问题1: 标签生成使用 mid-price 导致事件被漏掉

**发现日期**: 2025-12-07

**问题描述**:
- bid/ask 价格精度是 0.0001
- mid-price = (bid + ask) / 2，精度变成 0.00005
- 当阈值设为 0.0001 时，很多实际变化被归类为"不变"

**解决方案**: 改用 `bid1_px` 作为标签生成的价格基准

---

### 问题2: 浮点数精度问题导致比较失败

**发现日期**: 2025-12-07

**问题描述**:
```python
# 0.9998 - 0.9997 应该等于 0.0001
# 但实际结果是 9.999999999998899e-05
# 0.0001 >= 0.0001 返回 False！
```

**解决方案**:
- 对价格进行 `round(6)` 处理
- 使用容差比较: `price_diff >= (threshold - eps)`

---

### 问题3: 原标签方法漏掉往返变化

**发现日期**: 2025-12-07

**问题描述**:
原方法比较 `current_price` 和 `future_N_min_price`。
如果价格在N分钟内先涨后跌，变化被抵消，标签为"不变"。

**解决方案**: 改为"事件检测"方法
```
新方法：
1. 找到所有价格变化事件（diff >= threshold）
2. 对每个事件，往前标记horizon分钟为"即将变化"
```

---

## 标签分布对比

### 修复前
```
全部数据: 下降 0.08% | 不变 99.85% | 上涨 0.08%
测试集:   下降 0.00% | 不变 99.95% | 上涨 0.05%
```

### 修复后 ✅
```
全部数据: 下降 2.56% | 不变 94.25% | 上涨 3.19%
测试集:   下降 1.71% | 不变 96.47% | 上涨 1.82%
```

变化事件从几乎为0增加到合理水平！

---

## 特征设计方案 V2

### 核心参数
- **预测周期**: 5 分钟
- **历史窗口**: 30 分钟
- **特征数量**: 57 个

### 特征重要性排序
1. **⭐⭐⭐ 最重要**: 一档加速度
2. **⭐⭐ 重要**: 一档速度、不平衡
3. **⭐ 辅助**: 二档加速度、一档二档比值变化

---

## 开发日志

### 2025-12-07

#### 上午
- 项目结构搭建
- 初版特征工程
- 发现标签严重不平衡

#### 数据问题排查与修复
1. mid-price 精度问题 → 改用 bid1_px
2. 浮点精度问题 → round(6) + 容差比较
3. 往返变化被抵消 → 改为事件检测方法

#### 修复后
- 标签分布合理（下降2.56% | 不变94.25% | 上涨3.19%）
- 测试集有足够正样本

---
