# 项目进展记录

## 里程碑

| 阶段 | 目标 | 状态 | 完成日期 |
|------|------|------|----------|
| Phase 1 | 项目结构搭建 | ✅ 已完成 | 2025-12-07 |
| Phase 2 | 数据处理模块 | ✅ 已完成 | 2025-12-07 |
| Phase 3 | 特征设计讨论 | ✅ 已完成 | 2025-12-07 |
| Phase 4 | 特征工程重构 | 🔄 进行中 | - |
| Phase 5 | 模型训练 | ⏸️ 未开始 | - |

---

## 稳定币数据特性

### 标签分布

| 类别 | 占比 |
|------|------|
| 下降 (0) | 1.03% |
| 不变 (1) | 97.94% |
| 上升 (2) | 1.02% |

> **这是正常的！** 稳定币价格大部分时间保持稳定，我们要捕获的正是那 ~2% 的变化机会。

### 关键洞察

传统技术指标（MA/RSI/Bollinger Bands）对稳定币**无效**，因为：
- 价格几乎恒定在 1.0
- 价格变化信号太弱

真正有意义的是**订单簿结构的动态变化**。

---

## 特征设计方案 V2

### 设计原则

1. **聚焦订单簿动态**：价格变化由买卖力量对比驱动
2. **关注变化趋势**：速度（一阶导数）比绝对值更重要
3. **加速度是关键**：二阶导数代表趋势的剧烈变化
4. **聪明钱信号**：二档订单反映大户预埋信息

### 核心参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 预测周期 | 5 分钟 | 短期预测 |
| 历史窗口 | 30 分钟 | 用于计算趋势 |
| 关注档位 | 1-2 档 | 买一卖一 + 买二卖二 |

### 特征清单

#### 1. 基础不平衡指标
| 特征名 | 计算公式 | 说明 |
|--------|----------|------|
| `imbalance_1` | (bid1_qty - ask1_qty) / (bid1_qty + ask1_qty) | 一档不平衡度 |
| `imbalance_2` | (bid2_qty - ask2_qty) / (bid2_qty + ask2_qty) | 二档不平衡度 |

#### 2. 深度变化率（速度）
| 特征名 | 计算公式 | 说明 |
|--------|----------|------|
| `bid1_qty_velocity` | bid1_qty(t) - bid1_qty(t-1) | 买一深度变化 |
| `ask1_qty_velocity` | ask1_qty(t) - ask1_qty(t-1) | 卖一深度变化 |
| `bid2_qty_velocity` | bid2_qty(t) - bid2_qty(t-1) | 买二深度变化 |
| `ask2_qty_velocity` | ask2_qty(t) - ask2_qty(t-1) | 卖二深度变化 |

#### 3. 变化加速度（二阶导数）⭐ 最重要
| 特征名 | 计算公式 | 说明 |
|--------|----------|------|
| `bid1_qty_accel` | Δ(bid1_qty_velocity) | 买一深度加速度 |
| `ask1_qty_accel` | Δ(ask1_qty_velocity) | 卖一深度加速度 |
| `bid2_qty_accel` | Δ(bid2_qty_velocity) | 买二深度加速度 |
| `ask2_qty_accel` | Δ(ask2_qty_velocity) | 卖二深度加速度 |

#### 4. 不平衡的速度和加速度
| 特征名 | 计算公式 | 说明 |
|--------|----------|------|
| `imbalance_1_velocity` | Δimbalance_1 | 不平衡变化速度 |
| `imbalance_1_accel` | Δ²imbalance_1 | 不平衡变化加速度 |
| `imbalance_2_velocity` | Δimbalance_2 | 二档不平衡速度 |
| `imbalance_2_accel` | Δ²imbalance_2 | 二档不平衡加速度 |

#### 5. 一档二档比值（聪明钱指标）
| 特征名 | 计算公式 | 说明 |
|--------|----------|------|
| `bid_ratio_12` | bid1_qty / bid2_qty | 买一/买二比值 |
| `ask_ratio_12` | ask1_qty / ask2_qty | 卖一/卖二比值 |
| `bid_ratio_12_velocity` | Δbid_ratio_12 | 比值变化速度 |
| `ask_ratio_12_velocity` | Δask_ratio_12 | 比值变化速度 |

#### 6. 累计指标（滚动窗口）
| 特征名 | 说明 |
|--------|------|
| `imbalance_1_sum_5` | 过去5分钟不平衡累计 |
| `imbalance_1_sum_15` | 过去15分钟不平衡累计 |
| `accel_sum_5` | 过去5分钟加速度累计 |

#### 7. 价差相关
| 特征名 | 计算公式 | 说明 |
|--------|----------|------|
| `spread` | ask1_px - bid1_px | 买卖价差 |
| `spread_velocity` | Δspread | 价差变化 |

### 去掉的特征
- ~~MA, EMA~~ - 价格恒定无意义
- ~~RSI, Bollinger Bands~~ - 依赖价格变化
- ~~mid_price~~ - 恒定
- ~~3-5档数据~~ - 暂不考虑

### 预计特征数量
约 **25-30 个**（精简且有意义）

---

## 下一步

- [ ] 更新 config.yaml (lookback_window: 30)
- [ ] 重写 feature_engineering.py
- [ ] 重新生成特征数据
- [ ] 验证特征分布

---

## 开发日志

### 2025-12-07

#### 上午
- 项目结构搭建
- 初版特征工程 (83个特征)
- 发现标签严重不平衡

#### 特征设计讨论
- 确认稳定币特性：价格恒定，传统技术指标无效
- 讨论订单簿动态特征
- 确定核心特征：深度变化的速度和加速度
- 确定聪明钱指标：一档二档比值变化
- 确定时间窗口：历史30分钟，预测5分钟

---
